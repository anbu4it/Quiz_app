{% extends "base.html" %}

{% block title %}Result | Flask Quiz{% endblock %}

{% block content %}
<style>
    .result-container {
        max-width: 600px;
        margin: 2rem auto;
    }
    .score-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 2rem;
    }
    .score-text {
        font-size: 3rem;
        font-weight: bold;
        color: #2c3e50;
    }
    .progress {
        height: 25px;
        border-radius: 15px;
        margin: 1.5rem 0;
    }
    .message {
        font-size: 1.2rem;
        margin: 1.5rem 0;
    }
    .action-buttons {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
    }
    .btn-custom {
        padding: 0.75rem 1.5rem;
        border-radius: 25px;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    .confetti {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
        pointer-events: none;
    }
</style>

<div class="result-container">
    <div class="score-card text-center">
        <h2 class="mb-4">
            <span class="display-6">ðŸŽ‰ Well done,</span>
            <br>
            <span class="display-5 fw-bold text-primary">{{ username }}!</span>
        </h2>

        <div class="score-text mb-3">{{ score }} / {{ total }}</div>

        <div class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated
                {% if score / total >= 0.7 %}bg-success
                {% elif score / total >= 0.4 %}bg-warning
                {% else %}bg-danger{% endif %}" 
                role="progressbar" 
                style="width: {{ (score / total * 100)|round(0) }}%;">
                {{ (score / total * 100)|round(0) }}%
            </div>
        </div>

        <div class="message 
            {% if score / total >= 0.7 %}text-success
            {% elif score / total >= 0.4 %}text-warning
            {% else %}text-danger{% endif %}">
            {% if score / total >= 0.7 %}
                ðŸŒŸ Excellent performance! You're doing great!
            {% elif score / total >= 0.4 %}
                ðŸ’ª Good effort! Keep practicing to improve!
            {% else %}
                ðŸ˜Š Don't worry, practice makes perfect!
            {% endif %}
        </div>

        <div class="action-buttons">
            <a href="{{ url_for('main.index') }}" class="btn btn-primary btn-custom">
                Try Another Quiz ï¿½
            </a>
            {% if current_user.is_authenticated %}
            <a href="{{ url_for('auth.dashboard') }}" class="btn btn-success btn-custom">
                View Dashboard ðŸ“Š
            </a>
            {% else %}
            <a href="{{ url_for('auth.register') }}" class="btn btn-outline-success btn-custom">
                Sign Up to Track Progress ðŸ“ˆ
            </a>
            {% endif %}
        </div>
    </div>
</div>

{% if score / total >= 0.7 %}
<canvas id="confetti" class="confetti"></canvas>
<script>
    // Simple confetti animation for high scores
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const confetti = [];
    const confettiCount = 100;
    const gravity = 0.5;
    const terminalVelocity = 5;
    const drag = 0.075;
    const colors = [
        { front: '#4285F4', back: '#3372C3' },
        { front: '#EA4335', back: '#BC352A' },
        { front: '#FBBC05', back: '#C89B04' },
        { front: '#34A853', back: '#2A8644' }
    ];

    class Confetti {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.color = colors[Math.floor(Math.random() * colors.length)];
            this.dimensions = {
                x: Math.random() * 10 + 5,
                y: Math.random() * 10 + 5
            };
            this.velocity = {
                x: Math.random() * 6 - 3,
                y: Math.random() * -15 - 15
            };
            this.rotation = Math.random() * 360;
            this.rotationSpeed = Math.random() * 10 - 5;
        }

        update() {
            this.velocity.x += Math.random() * 0.2 - 0.1;
            this.velocity.y += gravity;
            this.velocity.x *= (1 - drag);
            this.velocity.y *= (1 - drag);
            this.velocity.y = Math.min(this.velocity.y, terminalVelocity);

            this.x += this.velocity.x;
            this.y += this.velocity.y;
            this.rotation += this.rotationSpeed;
        }

        draw() {
            ctx.save();
            ctx.translate(this.x, this.y);
            ctx.rotate(this.rotation * Math.PI / 180);

            ctx.fillStyle = this.color.front;
            ctx.fillRect(-this.dimensions.x / 2, -this.dimensions.y / 2, 
                        this.dimensions.x, this.dimensions.y);

            ctx.restore();
        }
    }

    for (let i = 0; i < confettiCount; i++) {
        confetti.push(new Confetti(Math.random() * canvas.width, -20));
    }

    let lastTime = performance.now();
    function animate(currentTime) {
        const deltaTime = currentTime - lastTime;
        lastTime = currentTime;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        confetti.forEach((confetto, index) => {
            confetto.update();
            confetto.draw();

            if (confetto.y > canvas.height) {
                confetti.splice(index, 1);
            }
        });

        if (confetti.length > 0) {
            requestAnimationFrame(animate);
        }
    }

    requestAnimationFrame(animate);
</script>
{% endif %}
{% endblock %}
